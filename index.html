<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bidayet - Alışkanlık Takibi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .timer-box {
            background-color: #1e293b; /* slate-800 */
            border: 1px solid #334155; /* slate-700 */
        }
        .icon-selection-item.selected {
            outline: 2px solid #a855f7; /* purple-500 */
            background-color: #334155;
        }
        .award-item { animation: pop-in 0.5s ease-out forwards; }
        @keyframes pop-in {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .modal-enter { animation: modal-fade-in 0.2s ease-out forwards; }
        .modal-leave { animation: modal-fade-in 0.2s ease-out reverse forwards; }
        @keyframes modal-fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .tab-btn.active {
            border-bottom-color: #a855f7; /* purple-500 */
            color: #f1f5f9; /* slate-100 */
        }
        /* Hide views by default */
        #habits-list-view, #add-habit-view, #tracker-view, #build-tracker-view, #auth-view {
            display: none;
        }
        .calendar-day.completed {
             background-color: #166534; /* green-800 */
             border-color: #22c55e; /* green-500 */
        }
         .calendar-day.today {
            outline: 2px solid #a855f7; /* purple-500 */
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-300 flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-md mx-auto bg-slate-800 p-6 sm:p-8 rounded-2xl shadow-lg transition-all duration-300">

        <!-- Auth View -->
        <div id="auth-view">
             <div class="text-center mb-8">
                 <h1 class="text-3xl font-bold text-white">Bidayet'e Hoş Geldiniz</h1>
                 <p class="text-slate-400 mt-2">Alışkanlıklarınızı yönetmek için giriş yapın.</p>
            </div>
            <form id="login-form" class="space-y-4">
                <input type="email" id="login-email" placeholder="E-posta" required class="w-full px-4 py-3 bg-slate-700 border border-slate-600 text-white rounded-lg focus:ring-2 focus:ring-purple-500">
                <input type="password" id="login-password" placeholder="Şifre" required class="w-full px-4 py-3 bg-slate-700 border border-slate-600 text-white rounded-lg focus:ring-2 focus:ring-purple-500">
                <button type="submit" class="w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700">Giriş Yap</button>
                <p class="text-center text-sm text-slate-400">Hesabın yok mu? <button type="button" id="show-register-btn" class="font-semibold text-purple-400 hover:underline">Kayıt Ol</button></p>
            </form>
            <form id="register-form" class="space-y-4 hidden">
                 <input type="email" id="register-email" placeholder="E-posta" required class="w-full px-4 py-3 bg-slate-700 border border-slate-600 text-white rounded-lg focus:ring-2 focus:ring-purple-500">
                <input type="password" id="register-password" placeholder="Şifre" required class="w-full px-4 py-3 bg-slate-700 border border-slate-600 text-white rounded-lg focus:ring-2 focus:ring-purple-500">
                <button type="submit" class="w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700">Kayıt Ol</button>
                 <p class="text-center text-sm text-slate-400">Zaten hesabın var mı? <button type="button" id="show-login-btn" class="font-semibold text-purple-400 hover:underline">Giriş Yap</button></p>
            </form>
            <p id="auth-error" class="text-red-400 text-center mt-4 h-4"></p>
        </div>

        <!-- List View -->
        <div id="habits-list-view">
            <div class="text-center mb-6 relative">
                 <button id="logout-btn" class="absolute top-0 right-0 text-slate-400 hover:text-white" title="Çıkış Yap"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg></button>
                 <h1 class="text-3xl font-bold mt-4 text-white">Bidayet</h1>
                 <p id="user-email-display" class="text-slate-400 mt-2 text-sm"></p>
            </div>
            <div class="border-b border-slate-700 mb-4">
                <nav class="-mb-px flex space-x-6 justify-center" aria-label="Tabs">
                    <button id="tab-quit" class="tab-btn active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-slate-400 border-transparent">Bırakılanlar</button>
                    <button id="tab-build" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-slate-400 border-transparent">Zincirler</button>
                </nav>
            </div>
            <div id="quit-habits-container">
                <div id="habits-list" class="space-y-3 mb-6"></div>
            </div>
            <div id="build-habits-container" class="hidden">
                 <div id="building-habits-list" class="space-y-3 mb-6"></div>
            </div>
            <button id="add-new-habit-btn" class="w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-transform transform hover:scale-102">Yeni Alışkanlık Ekle</button>
        </div>

        <!-- Add Habit View -->
        <div id="add-habit-view">
            <h1 class="text-2xl font-bold text-center mb-6 text-white">Yeni Bir Alışkanlık</h1>
            <div class="space-y-4">
                 <fieldset class="mb-2">
                    <legend class="sr-only">Alışkanlık Tipi</legend>
                    <div class="flex justify-center gap-4">
                        <div>
                            <input type="radio" name="habit-type" value="quit" id="type-quit" class="peer hidden" checked><label for="type-quit" class="block cursor-pointer rounded-lg border border-slate-600 bg-slate-700 py-2 px-4 text-sm font-medium peer-checked:border-purple-500 peer-checked:ring-1 peer-checked:ring-purple-500">Bırakmak İstiyorum</label>
                        </div>
                        <div>
                            <input type="radio" name="habit-type" value="build" id="type-build" class="peer hidden"><label for="type-build" class="block cursor-pointer rounded-lg border border-slate-600 bg-slate-700 py-2 px-4 text-sm font-medium peer-checked:border-purple-500 peer-checked:ring-1 peer-checked:ring-purple-500">Yapmak İstiyorum</label>
                        </div>
                    </div>
                </fieldset>
                <input type="text" id="habit-input" placeholder="Örn: Sigarayı bırakmak" class="w-full px-4 py-3 bg-slate-700 border border-slate-600 text-white rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-colors">
                <h3 class="text-sm font-bold text-slate-400 pt-2 text-center">Bir Simge Seç</h3>
                <div id="icon-selection" class="flex flex-wrap gap-3 justify-center pb-2"></div>
                <button id="save-habit-btn" class="w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700">Kaydet ve Başla</button>
                <button id="back-to-list-btn" class="w-full bg-slate-600 text-slate-200 font-bold py-3 px-4 rounded-lg hover:bg-slate-500">Geri</button>
            </div>
        </div>

        <!-- Quit Tracker View -->
        <div id="tracker-view" class="relative">
            <button id="back-from-tracker-btn" class="absolute top-0 left-0 text-slate-400 hover:text-white p-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 17l-5-5m0 0l5-5m-5 5h12" /></svg></button>
            <div class="text-center pt-8 flex flex-col items-center">
                 <div id="habit-icon-display" class="w-12 h-12 mb-2"></div>
                <div class="flex items-center gap-2">
                    <h1 id="habit-display" class="text-2xl font-bold break-words text-white"></h1>
                    <button id="edit-habit-name-btn" class="text-slate-400 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg></button>
                </div>
                <p id="start-date-display" class="text-xs text-slate-400 mt-1"></p>
            </div>
            <div class="grid grid-cols-4 gap-2 sm:gap-4 text-center my-6">
                <div class="timer-box p-3 rounded-lg"><div id="days-el" class="text-3xl sm:text-4xl font-black text-white">00</div><div class="text-xs text-slate-400">GÜN</div></div>
                <div class="timer-box p-3 rounded-lg"><div id="hours-el" class="text-3xl sm:text-4xl font-black text-white">00</div><div class="text-xs text-slate-400">SAAT</div></div>
                <div class="timer-box p-3 rounded-lg"><div id="minutes-el" class="text-3xl sm:text-4xl font-black text-white">00</div><div class="text-xs text-slate-400">DAKİKA</div></div>
                <div class="timer-box p-3 rounded-lg"><div id="seconds-el" class="text-3xl sm:text-4xl font-black text-white">00</div><div class="text-xs text-slate-400">SANİYE</div></div>
            </div>
            <div id="awards-container" class="flex items-center justify-center gap-2 mt-6 min-h-[48px] p-2 bg-slate-900 rounded-lg"></div>
            <h3 class="font-bold text-center my-3 text-slate-400">İlerleme Zinciri</h3>
            <div id="chain-container" class="flex flex-wrap justify-center gap-2 p-4 bg-slate-900 rounded-lg border border-slate-700 min-h-[56px]"></div>
            <h3 class="font-bold text-center my-3 text-slate-400">Başa Dönmeler</h3>
            <div id="restarts-container" class="flex flex-wrap justify-center gap-2 p-4 bg-slate-900 rounded-lg border border-slate-700 min-h-[56px]"></div>
            <div class="grid grid-cols-2 gap-4 mt-6">
                <button id="restart-habit-btn" class="w-full bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-yellow-700 transition-colors">Yeniden Başla</button>
                <button id="delete-habit-btn" class="w-full bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors">Alışkanlığı Sil</button>
            </div>
        </div>
        
        <!-- Build Tracker View -->
        <div id="build-tracker-view" class="relative">
            <button id="back-from-build-tracker-btn" class="absolute top-0 left-0 text-slate-400 hover:text-white p-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 17l-5-5m0 0l5-5m-5 5h12" /></svg></button>
            <div class="text-center pt-8 flex flex-col items-center">
                 <div id="build-habit-icon-display" class="w-12 h-12 mb-2"></div>
                <div class="flex items-center gap-2">
                    <h1 id="build-habit-display" class="text-2xl font-bold break-words text-white"></h1>
                     <button id="edit-build-habit-name-btn" class="text-slate-400 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg></button>
                </div>
                <p id="build-streak-display" class="text-lg text-green-400 font-bold mt-2"></p>
            </div>
            <div id="build-awards-container" class="flex items-center justify-center gap-2 mt-4 min-h-[48px] p-2 bg-slate-900 rounded-lg"></div>
            <h3 class="font-bold text-center my-4 text-slate-400">Başarı Takvimi</h3>
            <div id="chain-calendar-grid" class="grid grid-cols-7 gap-2 text-center text-xs p-4 bg-slate-900 rounded-lg border border-slate-700"></div>
             <div class="grid grid-cols-1 gap-4 mt-6">
                <button id="delete-build-habit-btn" class="w-full bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors">Alışkanlığı Sil</button>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
     <div id="delete-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-lg p-8 shadow-xl max-w-sm w-full text-center border border-slate-700">
            <h2 class="text-xl font-bold mb-4 text-white">Emin misin?</h2>
            <p class="text-slate-400 mb-6">Bu alışkanlık kalıcı olarak silinecek. Bu işlem geri alınamaz.</p>
            <div class="flex justify-center gap-4">
                <button id="cancel-delete-btn" class="w-full bg-slate-600 text-slate-200 font-bold py-2 px-4 rounded-lg hover:bg-slate-500">İptal</button>
                <button id="confirm-delete-btn" class="w-full bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700">Sil</button>
            </div>
        </div>
    </div>
     <div id="restart-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-lg p-8 shadow-xl max-w-sm w-full text-center border border-slate-700">
            <h2 class="text-xl font-bold mb-4 text-white">Yeniden Başlatılsın mı?</h2>
            <p class="text-slate-400 mb-6">Sayaç sıfırlanacak ve bu bir başa dönme olarak kaydedilecek. Emin misin?</p>
            <div class="flex justify-center gap-4">
                <button id="cancel-restart-btn" class="w-full bg-slate-600 text-slate-200 font-bold py-2 px-4 rounded-lg hover:bg-slate-500">İptal</button>
                <button id="confirm-restart-btn" class="w-full bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-yellow-700">Yeniden Başlat</button>
            </div>
        </div>
    </div>
     <div id="edit-name-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-lg p-8 shadow-xl max-w-sm w-full border border-slate-700">
            <h2 class="text-xl font-bold mb-4 text-white">Alışkanlığı Düzenle</h2>
            <input type="text" id="edit-habit-name-input" class="w-full px-4 py-3 bg-slate-700 border border-slate-600 text-white rounded-lg focus:ring-2 focus:ring-purple-500 mb-6">
            <div class="flex justify-center gap-4">
                <button id="cancel-edit-name-btn" class="w-full bg-slate-600 text-slate-200 font-bold py-2 px-4 rounded-lg hover:bg-slate-500">İptal</button>
                <button id="confirm-edit-name-btn" class="w-full bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">Kaydet</button>
            </div>
        </div>
    </div>
     <div id="uncheck-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-lg p-8 shadow-xl max-w-sm w-full text-center border border-slate-700">
            <h2 class="text-xl font-bold mb-4 text-white">Zinciri Kırmak İstediğine Emin misin?</h2>
            <p class="text-slate-400 mb-6">Bugünkü tiki kaldırmak, zincirini bozabilir.</p>
            <div class="flex justify-center gap-4">
                <button id="cancel-uncheck-btn" class="w-full bg-slate-600 text-slate-200 font-bold py-2 px-4 rounded-lg hover:bg-slate-500">İptal</button>
                <button id="confirm-uncheck-btn" class="w-full bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700">Onayla</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, collection, onSnapshot, addDoc, deleteDoc, updateDoc, increment, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const ICONS = {
            'no-smoking': `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-full h-full text-red-400"><path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" /><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12.75l-7.5-7.5-7.5 7.5" transform="translate(0, -2)"/><path stroke-linecap="round" d="M19.5 12.75v-3.75c0-1.036-.84-1.875-1.875-1.875H6.375C5.339 7.125 4.5 7.964 4.5 9v3.75" /></svg>`,
            'no-coffee': `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-full h-full text-yellow-700"><path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" /><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 3v.75m-1.5-1.5v.75m1.5 0v.75m-1.5-1.5v.75M9.75 3v.75m-1.5-1.5v.75m1.5 0v.75m-1.5-1.5v.75M12 21v-8.25a4.5 4.5 0 014.5-4.5h.75a4.5 4.5 0 014.5 4.5V21M3 16.5V21" /></svg>`,
            'no-junk-food': `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-full h-full text-orange-400"><path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" /><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 12.75a9.75 9.75 0 01-9.75 9.75A9.75 9.75 0 012.25 12.75" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6H6a6 6 0 006 6z" /></svg>`,
            'no-phone': `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-full h-full text-sky-400"><path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" /><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" /></svg>`,
            'no-alcohol': `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-full h-full text-lime-400"><path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" /><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 7.5l.415-.415a.75.75 0 011.06 0l.415.415a.75.75 0 010 1.06l-.415.415a.75.75 0 01-1.06 0L8.25 8.56a.75.75 0 010-1.06zM15.75 7.5l.415-.415a.75.75 0 011.06 0l.415.415a.75.75 0 010 1.06l-.415.415a.75.75 0 01-1.06 0l-.415-.415a.75.75 0 010-1.06z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 21l-3-3m0 0l3-3m-3 3h12" /></svg>`,
            'target': `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-full h-full text-green-400"><path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a6 6 0 01-5.84 7.38v-4.82m5.84-2.56a14.953 14.953 0 00-2.582-7.78m-5.84 2.56a14.953 14.953 0 01-2.582-7.78m0 0a14.953 14.953 0 01-2.582 7.78m-2.32 0a14.953 14.953 0 012.582 7.78" /></svg>`,
            'book': `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-full h-full text-blue-400"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>`,
            'water': `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-full h-full text-cyan-400"><path stroke-linecap="round" stroke-linejoin="round" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm0 8.25-1.5 1.5-1.5-1.5" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 12.75v6.75" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12.75l-1.5 1.5-1.5-1.5" /></svg>`,
            'run': `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-full h-full text-green-400"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.972l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z" /></svg>`,
        };
        const STAR_SVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 text-yellow-400"><path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" /></svg>`;
        const MEDAL_SVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-10 h-10 text-amber-500"><path fill-rule="evenodd" d="M12.963 2.286a.75.75 0 00-1.071 0 11.948 11.948 0 00-5.225 4.254.75.75 0 00.978 1.135 10.45 10.45 0 014.298-3.64.75.75 0 00.978-1.135 11.948 11.948 0 00-5.225-4.254zM10.16 11.16A1.5 1.5 0 0112 9.66a1.5 1.5 0 011.84 1.5.75.75 0 001.428-.432 3 3 0 00-5.136-1.026.75.75 0 001.428.432z" clip-rule="evenodd" /><path d="M12 21a9 9 0 100-18 9 9 0 000 18zm0 2.25a11.25 11.25 0 100-22.5 11.25 11.25 0 000 22.5z" /></svg>`;
        const RESTART_SVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 text-red-500"><path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm-1.72 6.97a.75.75 0 10-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 101.06 1.06L12 13.06l1.72 1.72a.75.75 0 101.06-1.06L13.06 12l1.72-1.72a.75.75 0 10-1.06-1.06L12 10.94l-1.72-1.72z" clip-rule="evenodd" /></svg>`;

        const dom = {
            views: { auth: document.getElementById('auth-view'), list: document.getElementById('habits-list-view'), add: document.getElementById('add-habit-view'), tracker: document.getElementById('tracker-view'), buildTracker: document.getElementById('build-tracker-view') },
            habitsList: document.getElementById('habits-list'),
            buildingHabitsList: document.getElementById('building-habits-list'),
            habitInput: document.getElementById('habit-input'),
            addNewHabitBtn: document.getElementById('add-new-habit-btn'),
            saveHabitBtn: document.getElementById('save-habit-btn'),
            backToListBtn: document.getElementById('back-to-list-btn'),
            backFromTrackerBtn: document.getElementById('back-from-tracker-btn'),
            deleteHabitBtn: document.getElementById('delete-habit-btn'),
            habitDisplay: document.getElementById('habit-display'),
            startDateDisplay: document.getElementById('start-date-display'),
            daysEl: document.getElementById('days-el'),
            hoursEl: document.getElementById('hours-el'),
            minutesEl: document.getElementById('minutes-el'),
            secondsEl: document.getElementById('seconds-el'),
            chainContainer: document.getElementById('chain-container'),
            deleteModal: document.getElementById('delete-modal'),
            confirmDeleteBtn: document.getElementById('confirm-delete-btn'),
            cancelDeleteBtn: document.getElementById('cancel-delete-btn'),
            iconSelection: document.getElementById('icon-selection'),
            habitIconDisplay: document.getElementById('habit-icon-display'),
            awardsContainer: document.getElementById('awards-container'),
            loginForm: document.getElementById('login-form'),
            registerForm: document.getElementById('register-form'),
            authError: document.getElementById('auth-error'),
            showRegisterBtn: document.getElementById('show-register-btn'),
            showLoginBtn: document.getElementById('show-login-btn'),
            logoutBtn: document.getElementById('logout-btn'),
            userEmailDisplay: document.getElementById('user-email-display'),
            restartHabitBtn: document.getElementById('restart-habit-btn'),
            restartModal: document.getElementById('restart-modal'),
            cancelRestartBtn: document.getElementById('cancel-restart-btn'),
            confirmRestartBtn: document.getElementById('confirm-restart-btn'),
            restartsContainer: document.getElementById('restarts-container'),
            editHabitNameBtn: document.getElementById('edit-habit-name-btn'),
            editNameModal: document.getElementById('edit-name-modal'),
            editHabitNameInput: document.getElementById('edit-habit-name-input'),
            cancelEditNameBtn: document.getElementById('cancel-edit-name-btn'),
            confirmEditNameBtn: document.getElementById('confirm-edit-name-btn'),
            tabQuit: document.getElementById('tab-quit'),
            tabBuild: document.getElementById('tab-build'),
            quitHabitsContainer: document.getElementById('quit-habits-container'),
            buildHabitsContainer: document.getElementById('build-habits-container'),
            backFromBuildTrackerBtn: document.getElementById('back-from-build-tracker-btn'),
            buildHabitIconDisplay: document.getElementById('build-habit-icon-display'),
            buildHabitDisplay: document.getElementById('build-habit-display'),
            buildStreakDisplay: document.getElementById('build-streak-display'),
            buildAwardsContainer: document.getElementById('build-awards-container'),
            chainCalendarGrid: document.getElementById('chain-calendar-grid'),
            editBuildHabitNameBtn: document.getElementById('edit-build-habit-name-btn'),
            deleteBuildHabitBtn: document.getElementById('delete-build-habit-btn'),
            uncheckModal: document.getElementById('uncheck-modal'),
            cancelUncheckBtn: document.getElementById('cancel-uncheck-btn'),
            confirmUncheckBtn: document.getElementById('confirm-uncheck-btn'),
        };
        
        let timerInterval = null, db, auth, userId, allHabits = [], selectedHabitId = null, selectedIconId = null, unsubscribe;
        
        const firebaseConfig = {
            apiKey: "AIzaSyD0MQSEv71JY2PFYXfvGwsdZkzYh_X2dgM",
            authDomain: "bidayet-49a96.firebaseapp.com",
            projectId: "bidayet-49a96",
            storageBucket: "bidayet-49a96.firebasestorage.app",
            messagingSenderId: "654829403515",
            appId: "1:654829403515:web:d7b7d86e15ed04358b91de",
            measurementId: "G-M9F2CJDWZM"
        };
        
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
        } catch(e) {
            console.error("Firebase başlatılamadı.", e);
            document.getElementById('app-container').innerHTML = `<p class="text-red-400 text-center">Firebase yapılandırması eksik veya hatalı.</p>`;
        }

        // --- Navigasyon ve UI ---
        function showView(viewName) {
            Object.values(dom.views).forEach(v => { v.style.display = 'none'; });
            if(dom.views[viewName]) dom.views[viewName].style.display = 'block';
        }
        function showModal(modal) { modal.classList.remove('hidden', 'modal-leave'); modal.classList.add('modal-enter'); }
        function hideModal(modal) { modal.classList.remove('modal-enter'); modal.classList.add('modal-leave'); setTimeout(() => modal.classList.add('hidden'), 200); }
        function populateIcons() {
            dom.iconSelection.innerHTML = Object.entries(ICONS).map(([id, svg]) => `<button class="icon-selection-item w-12 h-12 p-2 rounded-lg bg-slate-700 hover:bg-slate-600" data-icon-id="${id}">${svg}</button>`).join('');
            dom.iconSelection.querySelectorAll('.icon-selection-item').forEach(btn => btn.addEventListener('click', () => {
                dom.iconSelection.querySelectorAll('.icon-selection-item').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedIconId = btn.dataset.iconId;
            }));
        }

        // --- Firebase İşlemleri ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;
                dom.userEmailDisplay.textContent = user.email;
                listenToHabits(userId);
                showView('list');
            } else {
                userId = null;
                if(unsubscribe) unsubscribe();
                stopTracking();
                dom.habitsList.innerHTML = '';
                allHabits = [];
                showView('auth');
            }
        });

        function listenToHabits(currentUserId) {
            if (!currentUserId) return;
            const habitsCollectionRef = collection(db, 'users', currentUserId, 'habits');
            unsubscribe = onSnapshot(habitsCollectionRef, (snapshot) => {
                allHabits = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                const quitHabits = allHabits.filter(h => h.type === 'quit' || !h.type).sort((a,b) => b.startTime.toDate() - a.startTime.toDate());
                const buildHabits = allHabits.filter(h => h.type === 'build').sort((a,b) => a.habitName.localeCompare(b.habitName));

                renderQuitHabitList(quitHabits);
                renderBuildHabitList(buildHabits);

                if (selectedHabitId) {
                    const currentQuitHabit = quitHabits.find(h => h.id === selectedHabitId);
                    const currentBuildHabit = buildHabits.find(h => h.id === selectedHabitId);

                    if (currentQuitHabit && dom.views.tracker.style.display === 'block') {
                        startTracking(currentQuitHabit);
                    } else if (currentBuildHabit && dom.views.buildTracker.style.display === 'block') {
                        startTrackingBuildHabit(currentBuildHabit);
                    } else {
                        stopTracking();
                    }
                }
            }, (error) => {
                console.error("Veri dinleme hatası:", error);
                if (error.code === 'permission-denied') {
                    dom.habitsList.innerHTML = `<div class="text-center p-4 bg-red-900 border border-red-700 rounded-lg"><p class="font-bold text-red-300">Erişim Hatası!</p><p class="text-sm text-red-400 mt-2">Veritabanı okuma izniniz yok. Lütfen Firebase projenizin Firestore Güvenlik Kurallarını kontrol edin.</p></div>`;
                }
            });
        }
        
        async function saveHabit(habitName, iconId) {
            if (!userId) return;
            const type = document.querySelector('input[name="habit-type"]:checked').value;
            const habitsCollectionRef = collection(db, 'users', userId, 'habits');
            
            let newHabitData;
            if (type === 'quit') {
                newHabitData = { habitName, iconId, type, startTime: new Date(), restartCount: 0, restartHistory: [] };
            } else {
                newHabitData = { habitName, iconId, type, createdAt: new Date(), completedDates: [] };
            }
            await addDoc(habitsCollectionRef, newHabitData);
        }

        async function deleteHabit(habitId) {
            if (!userId || !habitId) return;
            const habitDocRef = doc(db, 'users', userId, 'habits', habitId);
            await deleteDoc(habitDocRef);
        }
        async function restartHabit(habitId) {
            if (!userId || !habitId) return;
            const habitDocRef = doc(db, 'users', userId, 'habits', habitId);
            
            const habitToRestart = allHabits.find(h => h.id === habitId);
            if (!habitToRestart) return;

            const oldStartTime = habitToRestart.startTime.toDate();
            const durationDays = Math.floor((new Date() - oldStartTime) / 86400000);
            const newHistoryEntry = { durationDays: durationDays, restartedAt: new Date() };

            await updateDoc(habitDocRef, {
                startTime: new Date(),
                restartCount: increment(1),
                restartHistory: arrayUnion(newHistoryEntry)
            });
        }
        async function updateHabitName(habitId, newName) {
            if (!userId || !habitId || !newName) return;
            const habitDocRef = doc(db, 'users', userId, 'habits', habitId);
            await updateDoc(habitDocRef, { habitName: newName });
        }

        async function toggleCompletion(habitId) {
            if (!userId || !habitId) return;
            const habit = allHabits.find(h => h.id === habitId);
            if (!habit) return;

            const todayStr = new Date().toISOString().split('T')[0];
            const completedDates = habit.completedDates || [];
            const isCompletedToday = completedDates.includes(todayStr);

            if (isCompletedToday) {
                selectedHabitId = habitId;
                showModal(dom.uncheckModal);
            } else {
                const habitDocRef = doc(db, 'users', userId, 'habits', habitId);
                await updateDoc(habitDocRef, { completedDates: arrayUnion(todayStr) });
            }
        }
        
        async function confirmUncheck() {
            if (!userId || !selectedHabitId) return;
            const todayStr = new Date().toISOString().split('T')[0];
            const habitDocRef = doc(db, 'users', userId, 'habits', selectedHabitId);
            await updateDoc(habitDocRef, { completedDates: arrayRemove(todayStr) });
            hideModal(dom.uncheckModal);
        }

        // --- Render Fonksiyonları ---
        function renderQuitHabitList(quitHabits) {
            dom.habitsList.innerHTML = quitHabits.length === 0 ? `<p class="text-center text-slate-500 py-4">Henüz bırakmak için bir alışkanlık eklemedin.</p>` : quitHabits.map(habit => {
                const days = Math.floor((new Date() - habit.startTime.toDate()) / 86400000);
                const numStars = Math.floor(days / 10);
                const hasMedal = days >= 40;
                let awardsHTML = '';
                if (hasMedal) awardsHTML += `<div title="40 Günlük Başarı Madalyası!">${MEDAL_SVG.replace('w-10 h-10', 'w-6 h-6')}</div>`;
                const maxStarsToShow = 5;
                for (let i = 0; i < Math.min(numStars, maxStarsToShow); i++) {
                    awardsHTML += `<div title="${(i + 1) * 10} Günlük Başarı">${STAR_SVG.replace('w-8 h-8', 'w-5 h-5')}</div>`;
                }
                if (numStars > maxStarsToShow) awardsHTML += `<span class="text-xs font-bold text-yellow-500">+${numStars - maxStarsToShow}</span>`;

                return `<button class="w-full text-left p-4 bg-slate-700 border border-slate-600 rounded-lg hover:bg-slate-600 hover:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all flex items-center gap-4" data-habit-id="${habit.id}">
                    <div class="w-10 h-10 flex-shrink-0">${ICONS[habit.iconId] || ICONS['target']}</div>
                    <div class="flex-grow">
                        <p class="font-bold text-white truncate">${habit.habitName}</p>
                        <p class="text-sm text-purple-400 font-semibold">${days} gündür devam ediyor</p>
                        <div class="flex items-center gap-1 mt-2 min-h-[24px]">${awardsHTML}</div>
                    </div>
                </button>`;
            }).join('');
            dom.habitsList.querySelectorAll('button').forEach(btn => btn.addEventListener('click', () => {
                const habit = allHabits.find(h => h.id === btn.dataset.habitId);
                if (habit) startTracking(habit);
            }));
        }
        
        function renderBuildHabitList(buildHabits) {
            dom.buildingHabitsList.innerHTML = buildHabits.length === 0 ? `<p class="text-center text-slate-500 py-4">Henüz bir zincir başlatmadın.</p>` : buildHabits.map(habit => {
                const completedDates = habit.completedDates || [];
                const streak = calculateStreak(completedDates);
                const isCompletedToday = completedDates.includes(new Date().toISOString().split('T')[0]);

                const numStars = Math.floor(streak / 10);
                const hasMedal = streak >= 40;
                let awardsHTML = '';
                if (hasMedal) awardsHTML += `<div title="40 Günlük Zincir Madalyası!">${MEDAL_SVG.replace('w-10 h-10', 'w-6 h-6')}</div>`;
                const maxStarsToShow = 5;
                for (let i = 0; i < Math.min(numStars, maxStarsToShow); i++) {
                    awardsHTML += `<div title="${(i + 1) * 10} Günlük Zincir">${STAR_SVG.replace('w-8 h-8', 'w-5 h-5')}</div>`;
                }
                if (numStars > maxStarsToShow) awardsHTML += `<span class="text-xs font-bold text-yellow-500">+${numStars - maxStarsToShow}</span>`;


                return `<div class="w-full text-left p-2 bg-slate-700 border border-slate-600 rounded-lg flex items-center gap-3">
                    <button class="flex-grow flex items-center gap-3 text-left p-2 rounded-md hover:bg-slate-600" data-habit-id="${habit.id}">
                        <div class="w-10 h-10 flex-shrink-0">${ICONS[habit.iconId] || ICONS['target']}</div>
                        <div class="flex-grow">
                            <p class="font-bold text-white truncate">${habit.habitName}</p>
                            <p class="text-sm font-semibold ${streak > 0 ? 'text-green-400' : 'text-slate-400'}">${streak} günlük zincir</p>
                             <div class="flex items-center gap-1 mt-2 min-h-[24px]">${awardsHTML}</div>
                        </div>
                    </button>
                    <button class="toggle-completion-btn flex-shrink-0 font-bold py-2 px-4 rounded-lg text-sm ${isCompletedToday ? 'bg-green-600 text-white' : 'bg-slate-600 text-slate-200 hover:bg-slate-500'}" data-habit-id="${habit.id}">${isCompletedToday ? '✔' : 'Tik At'}</button>
                </div>`;
            }).join('');
            
            dom.buildingHabitsList.querySelectorAll('button[data-habit-id]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    if (e.target.closest('.toggle-completion-btn')) return;
                    const habit = allHabits.find(h => h.id === btn.dataset.habitId);
                    if (habit) startTrackingBuildHabit(habit);
                });
            });

            dom.buildingHabitsList.querySelectorAll('.toggle-completion-btn').forEach(btn => {
                btn.addEventListener('click', () => toggleCompletion(btn.dataset.habitId));
            });
        }
        
        function renderChain(days) {
            dom.chainContainer.innerHTML = days < 1 ? `<p class="text-sm text-slate-500">İlk gününü tamamladığında zincirin başlayacak.</p>` : Array.from({length: days}, (_, i) => `<div class="chain-link w-10 h-10 flex items-center justify-center bg-green-900 text-green-300 font-bold rounded-full border-2 border-green-700" style="animation-delay: ${i * 0.05}s">${i + 1}</div>`).join('');
        }
        function renderAwards(days) {
            const numStars = Math.floor(days / 10);
            const hasMedal = days >= 40;
            let awardsHTML = '';
            if (hasMedal) awardsHTML += `<div class="award-item" title="40 Günlük Başarı Madalyası!">${MEDAL_SVG}</div>`;
            for (let i = 0; i < numStars; i++) awardsHTML += `<div class="award-item" style="animation-delay:${(i * 0.1) + 0.1}s" title="${(i+1)*10} Günlük Başarı">${STAR_SVG}</div>`;
            dom.awardsContainer.innerHTML = awardsHTML || `<p class="text-sm text-slate-500">Her 10 günde bir yıldız kazan!</p>`;
        }
         function renderBuildAwards(streak) {
            const numStars = Math.floor(streak / 10);
            const hasMedal = streak >= 40;
            let awardsHTML = '';
            if (hasMedal) awardsHTML += `<div class="award-item" title="40 Günlük Zincir Madalyası!">${MEDAL_SVG}</div>`;
            for (let i = 0; i < numStars; i++) {
                awardsHTML += `<div class="award-item" style="animation-delay:${(i * 0.1) + 0.1}s" title="${(i+1)*10} Günlük Zincir">${STAR_SVG}</div>`;
            }
            dom.buildAwardsContainer.innerHTML = awardsHTML || `<p class="text-sm text-slate-500">Her 10 günde bir yıldız kazan!</p>`;
        }
        function renderRestarts(history) {
            const restartHistory = history || [];
            if (restartHistory.length === 0) {
                dom.restartsContainer.innerHTML = `<p class="text-sm text-slate-500">Hiç başa dönmedin. Harika gidiyorsun!</p>`;
                return;
            }
            restartHistory.sort((a, b) => a.restartedAt.toDate() - b.restartedAt.toDate());

            dom.restartsContainer.innerHTML = restartHistory.map((restart) => {
                const restartDate = restart.restartedAt.toDate();
                const titleText = `${restart.durationDays} günlük serinin ardından ${restartDate.toLocaleDateString('tr-TR')} tarihinde yeniden başlandı.`;
                return `<div class="restart-item award-item" title="${titleText}">${RESTART_SVG}</div>`;
            }).join('');
        }
        
        function renderChainCalendar(completedDates = []) {
            const today = new Date();
            const grid = [];
            const dayHeaders = ['Pzt', 'Sal', 'Çar', 'Per', 'Cum', 'Cmt', 'Paz'];
            grid.push(...dayHeaders.map(d => `<div class="font-bold text-slate-500">${d}</div>`));
            
            const startDate = new Date(today);
            startDate.setDate(today.getDate() - 41);
            
            let dayOfWeek = startDate.getDay();
            dayOfWeek = dayOfWeek === 0 ? 6 : dayOfWeek - 1; 

            for (let i = 0; i < dayOfWeek; i++) { grid.push('<div></div>'); }

            for (let i = 0; i < 42; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                const dateStr = currentDate.toISOString().split('T')[0];
                const isCompleted = completedDates.includes(dateStr);
                const isToday = dateStr === today.toISOString().split('T')[0];
                
                grid.push(`<div class="calendar-day h-9 flex items-center justify-center rounded-full border-2 border-slate-700 ${isCompleted ? 'completed' : ''} ${isToday ? 'today' : ''}">${currentDate.getDate()}</div>`);
            }
            dom.chainCalendarGrid.innerHTML = grid.join('');
        }

        // --- Uygulama Mantığı ---
        function calculateStreak(dates = []) {
            if (!dates || dates.length === 0) return 0;
            const dateSet = new Set(dates);
            let streak = 0;
            const today = new Date();
            today.setHours(12, 0, 0, 0); 
            
            let currentDate = new Date(today);
            
            if (!dateSet.has(currentDate.toISOString().split('T')[0])) {
                 currentDate.setDate(currentDate.getDate() - 1);
                 if (!dateSet.has(currentDate.toISOString().split('T')[0])) {
                     return 0;
                 }
            }
            
            while (dateSet.has(currentDate.toISOString().split('T')[0])) {
                streak++;
                currentDate.setDate(currentDate.getDate() - 1);
            }
            
            return streak;
        }

        function updateTimer(startTime) {
            const diff = new Date() - startTime;
            const d = Math.floor(diff / 86400000);
            const h = Math.floor((diff % 86400000) / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            dom.daysEl.innerText = String(d).padStart(2, '0');
            dom.hoursEl.innerText = String(h).padStart(2, '0');
            dom.minutesEl.innerText = String(m).padStart(2, '0');
            dom.secondsEl.innerText = String(s).padStart(2, '0');
            renderChain(d);
            renderAwards(d);
        }
        
        function startTracking(habit) {
            selectedHabitId = habit.id;
            dom.habitIconDisplay.innerHTML = ICONS[habit.iconId] || ICONS['target'];
            dom.habitDisplay.innerText = habit.habitName;
            const startTime = habit.startTime.toDate();
            dom.startDateDisplay.innerText = `Başlangıç: ${startTime.toLocaleString('tr-TR')}`;
            renderRestarts(habit.restartHistory);
            clearInterval(timerInterval);
            updateTimer(startTime);
            timerInterval = setInterval(() => updateTimer(startTime), 1000);
            showView('tracker');
        }
        
        function startTrackingBuildHabit(habit) {
            selectedHabitId = habit.id;
            dom.buildHabitIconDisplay.innerHTML = ICONS[habit.iconId] || ICONS['target'];
            dom.buildHabitDisplay.innerText = habit.habitName;
            const completedDates = habit.completedDates || [];
            const streak = calculateStreak(completedDates);
            dom.buildStreakDisplay.innerText = `${streak} günlük zincir`;
            renderBuildAwards(streak);
            renderChainCalendar(completedDates);
            showView('buildTracker');
        }

        function stopTracking() {
            clearInterval(timerInterval);
            selectedHabitId = null;
            if(dom.habitInput) dom.habitInput.value = '';
            showView('list');
        }
        
        // --- Olay Dinleyicileri ---
        dom.loginForm.addEventListener('submit', async (e) => { e.preventDefault(); try { await signInWithEmailAndPassword(auth, dom.loginForm['login-email'].value, dom.loginForm['login-password'].value); dom.authError.textContent = ''; } catch (error) { dom.authError.textContent = 'E-posta veya şifre hatalı.'; }});
        dom.registerForm.addEventListener('submit', async (e) => { e.preventDefault(); try { await createUserWithEmailAndPassword(auth, dom.registerForm['register-email'].value, dom.registerForm['register-password'].value); dom.authError.textContent = ''; } catch (error) { dom.authError.textContent = 'Kayıt başarısız. Lütfen tekrar deneyin.'; }});
        dom.logoutBtn.addEventListener('click', () => signOut(auth));
        dom.showRegisterBtn.addEventListener('click', () => { dom.loginForm.classList.add('hidden'); dom.registerForm.classList.remove('hidden'); dom.authError.textContent = ''; });
        dom.showLoginBtn.addEventListener('click', () => { dom.registerForm.classList.add('hidden'); dom.loginForm.classList.remove('hidden'); dom.authError.textContent = ''; });
        
        dom.addNewHabitBtn.addEventListener('click', () => { selectedIconId = 'target'; populateIcons(); dom.iconSelection.querySelector('[data-icon-id="target"]').classList.add('selected'); showView('add'); });
        dom.backToListBtn.addEventListener('click', () => showView('list'));
        dom.saveHabitBtn.addEventListener('click', () => { const habitName = dom.habitInput.value.trim(); if (habitName && selectedIconId) { saveHabit(habitName, selectedIconId); dom.habitInput.value = ''; showView('list'); } });
        
        dom.backFromTrackerBtn.addEventListener('click', stopTracking);
        dom.deleteHabitBtn.addEventListener('click', () => { if (selectedHabitId) showModal(dom.deleteModal); });
        dom.restartHabitBtn.addEventListener('click', () => { if (selectedHabitId) showModal(dom.restartModal); });
        
        dom.cancelDeleteBtn.addEventListener('click', () => hideModal(dom.deleteModal));
        dom.confirmDeleteBtn.addEventListener('click', () => { if (selectedHabitId) { deleteHabit(selectedHabitId); hideModal(dom.deleteModal); stopTracking(); } });
        
        dom.cancelRestartBtn.addEventListener('click', () => hideModal(dom.restartModal));
        dom.confirmRestartBtn.addEventListener('click', () => { if (selectedHabitId) { restartHabit(selectedHabitId); hideModal(dom.restartModal); } });

        dom.editHabitNameBtn.addEventListener('click', () => { const habit = allHabits.find(h => h.id === selectedHabitId); if(habit) { dom.editHabitNameInput.value = habit.habitName; showModal(dom.editNameModal); } });
        dom.cancelEditNameBtn.addEventListener('click', () => hideModal(dom.editNameModal));
        dom.confirmEditNameBtn.addEventListener('click', () => { const newName = dom.editHabitNameInput.value.trim(); if(selectedHabitId && newName) { updateHabitName(selectedHabitId, newName); hideModal(dom.editNameModal); } });
        
        dom.tabQuit.addEventListener('click', () => { dom.tabQuit.classList.add('active'); dom.tabBuild.classList.remove('active'); dom.quitHabitsContainer.classList.remove('hidden'); dom.buildHabitsContainer.classList.add('hidden'); });
        dom.tabBuild.addEventListener('click', () => { dom.tabBuild.classList.add('active'); dom.tabQuit.classList.remove('active'); dom.buildHabitsContainer.classList.remove('hidden'); dom.quitHabitsContainer.classList.add('hidden'); });
        
        dom.backFromBuildTrackerBtn.addEventListener('click', stopTracking);
        dom.deleteBuildHabitBtn.addEventListener('click', () => { if (selectedHabitId) showModal(dom.deleteModal); });
        dom.editBuildHabitNameBtn.addEventListener('click', () => { const habit = allHabits.find(h => h.id === selectedHabitId); if (habit) { dom.editHabitNameInput.value = habit.habitName; showModal(dom.editNameModal); } });
        
        dom.cancelUncheckBtn.addEventListener('click', () => hideModal(dom.uncheckModal));
        dom.confirmUncheckBtn.addEventListener('click', confirmUncheck);

    </script>
</body>
</html>

